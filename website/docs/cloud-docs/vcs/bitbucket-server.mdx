---
page_title: Bitbucket Server and Data Center - VCS Providers - Terraform Cloud
---

# Configuring Bitbucket Server/Data Center Access

These instructions are for using **Bitbucket Server** for Terraform Cloud's VCS features.

These instructions also apply to **Bitbucket Data Center**, which is a variant of Bitbucket Server that supports clustering. Terraform Cloud treats these two products identically and Bitbucket Data Center users select **Bitbucket Server** as their VCS Provider type. Unless stated otherwise, any reference to Bitbucket Server in this document also apply to Bitbucket Data Center.

Configuring a new VCS provider requires permission to manage VCS settings for the organization. ([More about permissions.](/cloud-docs/users-teams-organizations/permissions))

[permissions-citation]: #intentionally-unused---keep-for-maintainers

[Bitbucket Cloud has separate instructions,](/cloud-docs/vcs/bitbucket-cloud) as do the [other supported VCS providers.](/cloud-docs/vcs)

Bitbucket Server requires both OAuth authentication and an SSH key. These instructions cover both requirements.

-> **Version note:** Terraform Cloud supports Bitbucket Server and Bitbucket Data Center versions 5.4.0 and above. <br /><br />Terraform Cloud deprecated support for Bitbucket Server versions between 4.9.1 and 5.3.7. Terraform Cloud currently works with these versions, but support ends in the near future. <br /><br />HashiCorp does not test older versions of Bitbucket Server with Terraform Cloud and might not work. Although we do not proactively remove support for versions at end of life (per the [Atlassian Support End of Life Policy](https://confluence.atlassian.com/support/atlassian-support-end-of-life-policy-201851003.html)), there might be limits to our ability to resolve customer issues with end of life versions.

~> **Important:** Terraform Cloud needs to contact Bitbucket Server over both SSH and HTTP (or HTTPS) during setup and during normal operation. For the SaaS version of Terraform Cloud, Bitbucket Server must be internet-accessible on its SSH and HTTP(S) ports. For Terraform Enterprise, you must have network connectivity between your Terraform Enterprise and Bitbucket Server instances. <br /><br /> Note that [Bitbucket Server's default ports](https://confluence.atlassian.com/bitbucketserverkb/which-ports-does-bitbucket-server-listen-on-and-what-are-they-used-for-806029586.html) are 7999 for SSH and 7990 for HTTP. Check your configuration to confirm your instance's real ports.

## Before You Begin: Determine Your Bitbucket Server Version

Terraform Cloud requires support for the delivery of webhooks to perform many operations, including tracking newly available configuration versions. When using Bitbucket Server version 5.3 or below (**deprecated**), Atlassian's webhooks plugin require configuration on Bitbucket Server. If using version 5.4 or above, you do not require any plugin because webhooks have native supporte.

1. Open your Bitbucket server instance in your browser and log in as an admin user.

1. In the footer of every page is a reference to the instance's current version. **If your version is greater than v5.4.0, you may skip all remaining steps in this section.**

1. Go to the **Manage add-ons** page. You can click the gear icon in the upper right corner and then use the **Manage add-ons** link in the sidebar or go directly to `https://<BITBUCKET INSTANCE HOSTNAME>/plugins/servlet/upm`.

1. Locate an add-on named **Web Post Hooks for Bitbucket Server**. Verify you installed and enabled it because `Disabled` is the plugin's default setting. If necessary, toggle the setting to `Enabled`.

1. If the plugin is not present, click **Find new add-ons** in the sidebar navigation. Search for the plugin by name and install it.

   Make sure to install the correct plugin. Terraform Cloud works best with [Web Post Hooks for Bitbucket Server by Atlassian ](https://marketplace.atlassian.com/apps/1211539/web-post-hooks-for-bitbucket-server?hosting=server&tab=overview).

1. Visit the repository's settings, click on `Hooks`, and very you _enabled_ the plugin there as well.

There is an option to configure a `webhook URL` on the plugin. Leave this optional field blank. Terraform Cloud dynamically updates the `webhook URL` after you establish the VCS connection.

Leave the page open in a browser tab, and remain logged in as an admin user.

## Adding a New VCS Provider on Terraform Cloud

1. Open Terraform Cloud in your browser and navigate to **Settings > Version Control > Providers** for your organization.

1. Click **Add VCS Provider**. If you just created your organization, you might already be on this page. Otherwise:

   1. Make sure the bottom-left organization menu currently shows your organization.
   1. Click the **Settings** link at the top of the page (or within the ☰ menu).
   1. On the next page, click **Providers** under **Version Control** in the left sidebar.
   1. Click **Add a VCS Provider**.

1. To use Bitbucket as your version control provider, select **Bitbucket Server** from the **Bitbucket** dropdown. The page moves to the next step.

1. (Optional) Enter a **Name** for this VCS connection.

1. Enter the URL of your Bitbucket Server instance in the **HTTP URL** and **API URL** fields.

   ~> **Important:** The values for the **HTTP URL** and **API URL** fields differ depending on whether or not your Bitbucket Server instance has a [context path](https://confluence.atlassian.com/bitbucketserver/moving-bitbucket-server-to-a-different-context-path-776640153.html) set.

   If your Bitbucket Server instance does not have a context path set, the **API URL** should be the same as the **HTTP URL**.

   If your Bitbucket Server instance has a context path set:

   1. Set the **HTTP URL** to the URL of your Bitbucket Server instance with the context path included, `https://<BITBUCKET INSTANCE HOSTNAME>/<CONTEXT PATH>`.
   1. Set the **API URL** to the URL of your Bitbucket Server instance **without** the context path, `https://<BITBUCKET INSTANCE HOSTNAME>`.

   ~> **Important:** If Bitbucket Server is inaccessible on the standard ports (for example, if it's using its default ports of 7990 or 8443 and is not behind a reverse proxy), make sure to specify the port in the URL. If you omit the port in the URL, Terraform Cloud uses the standard port for the protocol (80 for HTTP, 443 for HTTPS).

1. Click **Continue** to view the generated **Consumer Key** and **Public Key** you can use to create a new Application Link in BitBucket Server. Leave this page open so you can copy and paste these values for future use.

    To use keys from an existing Application Link, toggle **Use Custom Keys** and enter them into the page.

## Creating a New Application Link on Bitbucket Server

1. While logged in as an admin user, go to Bitbucket Server's "Application Links" administration page. You can use the sidebar navigation in the admin pages, or go directly to `https://<BITBUCKET INSTANCE HOSTNAME>/plugins/servlet/applinks/listApplicationLinks`.

   This page has a text field for creating a new application link, followed by a list of existing application links.

1. Select **Create link** in application links.

1. Select **Atlassian product** as the link type. This option also works for external applications and lets you continue to use OAuth 1.0 integrations.

1. Enter Terraform Cloud's URL in the text field (https://app.terraform.io or the hostname of your Terraform Enterprise instance).

   ~> **Note:** If you connect multiple Terraform Cloud organizations to the same Bitbucket Server instance, you can only use Terraform Cloud's main URL once. For subsequent organizations, you can enter the organization URL instead. Organization URLs are the pages you click **Workspaces* on Terraform Cloud and look like `https://app.terraform.io/app/<ORG NAME>` or `https://<TFE HOSTNAME>/app/<ORG NAME>`.

1. In the **Configure application URL** box, confirm you want to use the URL exactly as you entered it. If you used Terraform Cloud's main URL, click *Continue**. If you used an organization URL, click the **Use this URL** checkbox.C

1. Click **Continue**.

1. In the "Link applications" box, fill out the following form fields:

   | Field                           | Value                          |
   | ------------------------------- | ------------------------------ |
   | Application Name (text)         | Terraform Cloud (`<ORG NAME>`) |
   | Application Type (drop-down)    | Generic Application            |
   | Create incoming link (checkbox) | ✔️ (enabled)                   |

   Leave all the other fields blank and click "Continue."

1. In the new **Link applications** box, fill in the **Consumer Key** and **Public Key** fields using the values from earlier. In the **Consumer Name** field, enter **Terraform Cloud** (`<ORG NAME>`).

1. Click "Continue" to go toa page on your Bitbucket Server instance asking if you want to authorize Terraform Cloud. Verify that you logged in as the user account Terraform Cloud uses, not as a Bitbucket administrator.

   If you get a 500 error, it usually means Terraform Cloud cannot reach your Bitbucket Server instance.

1. Click **Allow** to return to Terraform Cloud to enter a SSH key.

## Creating an SSH Key for Terraform Cloud

On a secure workstation, create an SSH keypair that Terraform Cloud can use to connect to Bitbucket Server. The exact command depends on your OS, but is usually something like `ssh-keygen -t rsa -m PEM -f "/Users/<NAME>/.ssh/service_terraform" -C "service_terraform_enterprise"`. This action creates a `service_terraform` file with the private key and a `service_terraform.pub` file with the public key.

This SSH key must have an empty passphrase. Terraform Cloud cannot use SSH keys that require a passphrase.

### Important Notes

- Do not use your personal SSH key to connect Terraform Cloud and Bitbucket Server. Generate a new one or use an existing key reserved for service access.
- In upcoming steps, you must provide Terraform Cloud with the private key. Although Terraform Cloud does not display the text of the key to users after you enter it, Terraform Cloud retains the key and uses it for authenticating to Bitbucket Server.
- Protect this private key carefully. It can push code to the repositories you use to manage your infrastructure. Follow your organization's policies for protecting important credentials.

## Switching Users and Add an SSH Key on Bitbucket Server

1. If you are still logged in to Bitbucket Server as an administrator, log out now.

1. Log in as whichever account you want Terraform Cloud to act as. For most organizations, this account should be a dedicated service user, but a personal account also works.

   ~> **Important:** The account you use for connecting Terraform Cloud must have admin access to any shared repositories of Terraform configurations because creating webhooks requires admin permissions.

1. Go to the **SSH keys** page. You can click the profile icon in the upper right corner, choose **Manage account** and click **SSH keys** in the sidebar navigation. You can also go directly to `https://<BITBUCKET INSTANCE HOSTNAME>/plugins/servlet/ssh/account/keys`.

1. Click **Add key**. Paste the text of the **SSH public key** you created previously (from the `.pub` file) into the text field.

1. Click **Add key**.

## Requesting Access and Add an SSH Private Key on Terraform Cloud

1. Click the **Add a private SSH key** link. A large text field appears. Paste the text of the **SSH private key** you created previously and click **Add SSH Key**.

You successfully configured Bitbucket Server access for Terraform Cloud. You can create Terraform workspaces based on your organization's repositories.
