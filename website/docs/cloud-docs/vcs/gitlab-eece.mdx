---
page_title: GitLab EE and CE - VCS Providers - Terraform Cloud
---

# Configuring GitLab EE and CE Access

These instructions are for using an on-premise installation of GitLab Enterprise Edition (EE) or GitLab Community Edition (CE) for Terraform Cloud's VCS features. [GitLab.com has separate instructions,](/cloud-docs/vcs/gitlab-com) as do the [other supported VCS providers.](/cloud-docs/vcs)

Configuring a new VCS provider requires permission to manage VCS settings for the organization. ([More about permissions.](/cloud-docs/users-teams-organizations/permissions))

[permissions-citation]: #intentionally-unused---keep-for-maintainers

Connecting Terraform Cloud to your VCS involves four steps:

| On your VCS                                                                                    | On Terraform Cloud                                                          |
| ---------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------- |
|                                                                                                | Create a new connection in Terraform Cloud. Get redirect URI.               |
| Register your Terraform Cloud organization as a new app. Provide redirect URI. Get ID and key. |                                                                             |
|                                                                                                | Provide Terraform Cloud with application ID and secret. Request VCS access. |
| Approve access request.                                                                        |                                                                             |

The rest of this page explains the on-premise GitLab versions of these steps.

~> **Important:** Terraform Cloud needs to contact your GitLab instance during setup and during normal operation. For the SaaS version of Terraform Cloud, GitLab must be internet-accessible. For Terraform Enterprise, you must have network connectivity between your Terraform Enterprise and GitLab instances.

-> **Note:** Alternately, you can skip the OAuth configuration process and authenticate with a personal access token. This method requires using Terraform Cloud's API. Refer to [the OAuth Clients API page](/cloud-docs/api-docs/oauth-clients) for details.

-> **Version Note:** Terraform Cloud supports GitLab versions 9.0 and newer. HashiCorp does not test older versions of GitLab with Terraform Cloud and they might not work as you expect. Although we do not deliberately remove support for versions at end of life (per the [GitLab Support End of Life Policy](https://docs.gitlab.com/ee/policy/maintenance.html#patch-releases)), there might be limits to our ability to resolve customer issues with end of life versions.

## Adding a New VCS Provider on Terrafom Cloud

1. Open Terraform Cloud in your browser and navigate to **Settings > Version Control > Providers** for your organization.

1. Click **Add VCS Provider**. If you just created your organization, you might already be on this page. Otherwise:

   1. Make sure the bottom-left organization menu currently shows your organization.
   1. Click the **Settings** link at the top of the page (or within the ☰ menu).
   1. On the next page, click **Providers** under **Version Control** in the left sidebar.
   1. Click **Add a VCS Provider**.

1. Select **GitLab Enterprise Edition** or **GitLab Community Edition** from the **Github** dropdown.

1. Fill in the **HTTP URL** and **API URL** of your GitLab Enterprise Edition or GitLab Community Edition instance, as well as an optional **Name** for this VCS connection.

1. Click **Continue**.

   | Field    | Value                                       |
   | -------- | ------------------------------------------- |
   | HTTP URL | `https://<GITLAB INSTANCE HOSTNAME>`        |
   | API URL  | `https://<GITLAB INSTANCE HOSTNAME>/api/v4` |

   Terraform Cloud uses GitLab's v4 API.

Leave the page open in a browser tab for future use.

## Creating a New Application on GitLab

1. In a new browser tab, open your GitLab instance and log in as whichever account you want Terraform Cloud to act as. For most organizations, this account should be a dedicated service user, but a personal account also works.

   ~> **Important:** The account you use for connecting Terraform Cloud must have admin access to any shared repositories of Terraform configurations because creating webhooks requires admin permissions. Do not create the application as an administrative application not owned by a user. Terraform Cloud needs user access to repositories to create webhooks and ingress configurations.

   ~> **Important**: In GitLab CE or EE 10.6 and up, you may also need to enable **Allow requests to the local network from hooks and services** on the **Outbound requests** section inside the Admin area under Settings (`/admin/application_settings/network`). Refer to [the GitLab documentation](https://docs.gitlab.com/ee/security/webhooks.html) for details.

1. Navigate to GitLab's **User Settings > Applications** page.

   You can reach this page at `https://<GITLAB INSTANCE HOSTNAME>/profile/applications`. You can also reach it through GitLab's menus:

   - In the upper right corner, click your profile picture and choose **Settings**.
   - In the navigation sidebar, click **Applications**.

1. This page has a list of applications and a form for adding new ones.

   Fill out the fields and checkboxes with the corresponding values currently displayed in your Terraform Cloud browser tab. Terraform Cloud lists the values in the order they appear and includes controls for copying values to your clipboard.

   Fill out the form as follows:

   | Field                   | Value                                          |
   | ----------------------- | ---------------------------------------------- |
   | Name                    | Terraform Cloud (`<YOUR ORGANIZATION NAME>`)   |
   | Redirect URI            | `https://app.terraform.io/<YOUR CALLBACK URL>` |
   | Confidential (checkbox) | ✔️ (enabled)                                   |
   | Expire access tokens (checkbox) | ✘ (disabled)                           |
   | Scopes (all checkboxes) | api                                            |

   -> **Note:** Terraform Cloud refreshes tokens if they are older than six hours, but GitLab marks OAuth tokens as expired if they are older than two hours. Disabling the **Expire access tokens** checkbox prevents Terraform Cloud from attempting to use expired tokens. 

1. Click **Save application**, which creates the application and takes you to its page.

1. Leave this page open in a browser tab. You need the unique **Application ID** and **Secret** for future use.

## Setting up Your Provider on Terraform Cloud

1. On the **Configure settings** page, enter the **Application ID** and **Secret**.

1. Click **Connect and continue** to go to a page on GitLab asking whether you want to authorize the app.

   If you receive a 500 error, it usually means Terraform Cloud cannot reach your GitLab instance.

1. Click **Authorize** at the bottom of the authorization page.

## Setting Up a PEM formatted SSH Keypair on Terraform Cloud (Optional)

Most organizations do not need to add an SSH private key. However, if the organization repositories include Git submodules that are only accessible using SSH, you can add an SSH key along with the OAuth credentials. You can add or update the SSH private key at a later time.

### Important Notes

- You only use SSH to clone Git submodules. All other Git operations still use HTTPS.
- Do not use your personal SSH key to connect Terraform Cloud and GitLab. Generate a new one or use an existing key reserved for service access.
- In upcoming steps, you must provide Terraform Cloud with the private key. Although Terraform Cloud does not display the text of the key to users after you enter it, Terraform Cloud retains the key and uses it for authenticating to GitLab.
- Protect this private key carefully. It can push code to the repositories you use to manage your infrastructure. Follow your organization's policies for protecting important credentials.

### If You Do Not Need a PEM formatted SSH Keypair:

1. Click **Skip and Finish** to return to Terraform Cloud's **VCS Providers** page, which now includes your new GitLab client.

### If You Do Need a PEM formatted SSH Keypair:

1. On a secure workstation, create a PEM formatted SSH keypair that Terraform Cloud can use to connect to GitLab. The exact command depends on your OS, but is usually something like `ssh-keygen -t rsa -m PEM -f "/Users/<NAME>/.ssh/service_terraform" -C "service_terraform_enterprise"`
  
   This action creates a `service_terraform` file with the private key and a `service_terraform.pub` file with the public key. This SSH key **must have an empty passphrase**. Terraform Cloud cannot use SSH keys that require a passphrase.

1. While logged into the GitLab account you want Terraform Cloud to act as, navigate to the **SSH Keys settings** page

1. Add a new SSH key and paste the value of the SSH public key you just created.

1. In Terraform Cloud's "Add VCS Provider" page, paste the text of the **SSH private key** you just created.

1. Click **Add SSH Key** to returns to Terraform Cloud's **VCS Provider** page, which now includes your new GitLab client.

You successfully configured GitHub access for Terraform Cloud. You can create Terraform workspaces based on your organization's repositories.
